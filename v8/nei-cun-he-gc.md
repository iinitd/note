# 内存和GC

## 内存模型

* 栈：L1 缓存
* 堆：L2 缓存

## 垃圾回收

* 划分
* 新生代（逻辑上分为 nursery 和 intermediate 子世代）
* 老生代
* 机制
* 新生对象首先被分配到 nursery。
* 经过一次 GC 后存活，则标记为 intermediate。
* 下一次 GC 后仍存活，则晋升（promotion）到老生代。

### 新生代 GC

* 并行清理算法：核心是复制，即用空间换时间。
* 新生代被拆分为两个大小相等的半空间，From 和 To。
* GC 时，检查 From 中的存活对象，复制到 To，并释放死亡对象的内存。
* 完成后，切换 From 和 To。

### 老生代 GC

* 标记清除算法
* 原理：从根集合开始，递归标记直接引用的对象。「可达」的对象即为存活对象。清除死亡对象。
* 根集合指的是一些固定可达对象的集合。
* 当前函数的局部变量和参数。
* 当前调用链上的所有函数的变量和参数
* 全局变量。
* 标记整理算法
* 原理：对存活对象进行标记后，将存活对象复制压缩到内存的一段连续区域。

### 内存泄漏

* 使用全局变量
* DOM 清空时还存在引用（子元素还存在）
* 在 IE 中使用闭包
* 定时器未清理
* V8 代码执行
* 预解析：检查语法错误
* 生成 AST
* 生成字节码：ignition
* 生成机器码：turbofan

